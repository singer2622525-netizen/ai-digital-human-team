# å¯†ç è‡ªåŠ¨æ”¶é›†å’Œä½¿ç”¨æŒ‡å—

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

å¯†ç ç®¡ç†åº“ç°åœ¨æ”¯æŒ**è‡ªåŠ¨æ”¶é›†**å’Œ**è‡ªåŠ¨è°ƒç”¨**åŠŸèƒ½ï¼š

1. **è‡ªåŠ¨æ£€æµ‹**ï¼šåœ¨å·¥ä½œè¿‡ç¨‹ä¸­è‡ªåŠ¨æ£€æµ‹éœ€è¦å‡­è¯çš„æœåŠ¡
2. **è‡ªåŠ¨æ”¶é›†**ï¼šä»é”™è¯¯ä¿¡æ¯ã€æ—¥å¿—ä¸­è‡ªåŠ¨æå–è´¦å·å¯†ç ä¿¡æ¯
3. **è‡ªåŠ¨è°ƒç”¨**ï¼šæ•°å­—äººéœ€è¦æ—¶è‡ªåŠ¨ä»å¯†ç åº“è·å–å‡­è¯
4. **æ™ºèƒ½æç¤º**ï¼šå¦‚æœå¯†ç åº“ä¸­æ²¡æœ‰ï¼Œä¼šæç¤ºç”¨æˆ·æ·»åŠ 

---

## ğŸš€ è‡ªåŠ¨è°ƒç”¨åŠŸèƒ½

### åœºæ™¯1ï¼šæ•°å­—äººåˆå§‹åŒ–æ—¶è‡ªåŠ¨è·å–å‡­è¯

```python
from ragflow_client import RAGFlowClient

# å¦‚æœå¯†ç åº“ä¸­æœ‰RAGFlowå‡­è¯ï¼Œä¼šè‡ªåŠ¨è·å–å¹¶è®¾ç½®
client = RAGFlowClient()
# æ— éœ€æ‰‹åŠ¨è®¾ç½®ç”¨æˆ·åå¯†ç ï¼Œè‡ªåŠ¨ä»å¯†ç åº“è·å–
```

### åœºæ™¯2ï¼šåœ¨æ•°å­—äººä»£ç ä¸­ä½¿ç”¨

```python
from credentials_auto import auto_get_credentials, auto_handle_service

# è‡ªåŠ¨è·å–å‡­è¯
credentials = auto_get_credentials(service_name="RAGFlow")
if credentials:
    username = credentials['username']
    password = credentials['password']

# æˆ–è€…è‡ªåŠ¨å¤„ç†æœåŠ¡è°ƒç”¨ï¼ˆå¤±è´¥æ—¶è‡ªåŠ¨è·å–å‡­è¯å¹¶é‡è¯•ï¼‰
def connect_ragflow():
    # è¿æ¥RAGFlowçš„é€»è¾‘
    pass

result = auto_handle_service("RAGFlow", connect_ragflow)
```

### åœºæ™¯3ï¼šä»ä¸Šä¸‹æ–‡è‡ªåŠ¨æ£€æµ‹æœåŠ¡

```python
from credentials_auto import get_auto_manager

manager = get_auto_manager()

# ä»é”™è¯¯ä¿¡æ¯ä¸­æ£€æµ‹æœåŠ¡
error_msg = "è¿æ¥RAGFlowçŸ¥è¯†åº“å¤±è´¥ï¼Œéœ€è¦è®¤è¯"
service_name = manager.detect_service_from_context(error_msg)
print(service_name)  # è¾“å‡º: RAGFlow

# è‡ªåŠ¨è·å–å‡­è¯
credentials = manager.auto_get_credentials(context=error_msg)
```

---

## ğŸ“¥ è‡ªåŠ¨æ”¶é›†åŠŸèƒ½

### åœºæ™¯1ï¼šä»é”™è¯¯ä¿¡æ¯æ”¶é›†

```python
from credentials_collector import CredentialsCollector

collector = CredentialsCollector()

# ä»é”™è¯¯ä¿¡æ¯ä¸­æ”¶é›†
error_msg = """
è¿æ¥å¤±è´¥: https://ragflow.suuntoyun.com
é”™è¯¯: éœ€è¦è®¤è¯
ç”¨æˆ·å: myuser
å¯†ç : mypass
"""

result = collector.collect_from_error(error_msg)
# result åŒ…å«ï¼š
# - service_name: "RAGFlow"
# - needs_credentials: True
# - extracted_info: æå–çš„ä¿¡æ¯
# - suggestion: å»ºè®®çš„æ“ä½œ
```

### åœºæ™¯2ï¼šè‡ªåŠ¨æ”¶é›†å¹¶ä¿å­˜

```python
from credentials_collector import CredentialsCollector

collector = CredentialsCollector()

# ä»ä¸Šä¸‹æ–‡è‡ªåŠ¨æ”¶é›†å¹¶ä¿å­˜
context = """
å°è¯•è¿æ¥RAGFlow: https://ragflow.suuntoyun.com
éœ€è¦ç”¨æˆ·åå’Œå¯†ç 
ç”¨æˆ·å: myuser
å¯†ç : mypass
"""

# è‡ªåŠ¨æ”¶é›†å¹¶ä¿å­˜ï¼ˆäº¤äº’å¼ï¼‰
collector.auto_collect_and_save(context, interactive=True)

# æˆ–è€…éäº¤äº’å¼ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
collector.auto_collect_and_save(context, interactive=False)
```

### åœºæ™¯3ï¼šä»æ–‡æœ¬æå–ä¿¡æ¯

```python
from credentials_collector import CredentialsCollector

collector = CredentialsCollector()

text = """
RAGFlowé…ç½®ï¼š
URL: https://ragflow.suuntoyun.com
ç”¨æˆ·å: admin
å¯†ç : secret123
API Key: abc123xyz
"""

extracted = collector.extract_from_text(text)
# extracted åŒ…å«ï¼š
# - urls: ["https://ragflow.suuntoyun.com"]
# - usernames: ["admin"]
# - passwords: ["secret123"]
# - api_keys: ["abc123xyz"]
# - service_name: "RAGFlow"
```

---

## ğŸ”§ å‘½ä»¤è¡Œå·¥å…·

### ä»é”™è¯¯ä¿¡æ¯æ”¶é›†

```bash
cd "03-æŠ€æœ¯å®ç°/05-é…ç½®ç®¡ç†"

python credentials_collector.py collect-from-error "è¿æ¥RAGFlowå¤±è´¥ï¼Œéœ€è¦è®¤è¯"
```

### è‡ªåŠ¨æ”¶é›†å¹¶ä¿å­˜

```bash
# äº¤äº’å¼ï¼ˆä¼šæç¤ºç¡®è®¤ï¼‰
python credentials_collector.py auto-collect "RAGFlowéœ€è¦ç”¨æˆ·åå’Œå¯†ç "

# éäº¤äº’å¼ï¼ˆè‡ªåŠ¨ä¿å­˜ï¼‰
python credentials_collector.py auto-collect "RAGFlowéœ€è¦ç”¨æˆ·åå’Œå¯†ç " --no-interactive
```

### ä»æ–‡æœ¬æå–

```bash
python credentials_collector.py extract "RAGFlow URL: https://ragflow.suuntoyun.com ç”¨æˆ·å: admin"
```

---

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´å·¥ä½œæµç¨‹

```
1. æ•°å­—äººå°è¯•è¿æ¥æœåŠ¡
   â†“
2. å¦‚æœå¤±è´¥ï¼Œæ£€æµ‹é”™è¯¯ä¿¡æ¯
   â†“
3. è‡ªåŠ¨æ£€æµ‹æœåŠ¡åç§°
   â†“
4. ä»å¯†ç åº“è·å–å‡­è¯
   â†“
5. å¦‚æœå¯†ç åº“ä¸­æ²¡æœ‰ï¼š
   - ä»é”™è¯¯ä¿¡æ¯ä¸­æå–å‡­è¯ï¼ˆå¦‚æœæœ‰ï¼‰
   - æç¤ºç”¨æˆ·æ·»åŠ å‡­è¯
   â†“
6. è‡ªåŠ¨è®¾ç½®ç¯å¢ƒå˜é‡
   â†“
7. é‡è¯•è¿æ¥
```

### ç¤ºä¾‹ï¼šRAGFlowè¿æ¥

```python
from ragflow_client import RAGFlowClient
from credentials_auto import get_auto_manager

# å°è¯•åˆ›å»ºå®¢æˆ·ç«¯
try:
    client = RAGFlowClient()
    # å¦‚æœå¯†ç åº“ä¸­æœ‰å‡­è¯ï¼Œä¼šè‡ªåŠ¨è·å–
except Exception as e:
    # å¦‚æœå¤±è´¥ï¼Œè‡ªåŠ¨æ”¶é›†å‡­è¯
    manager = get_auto_manager()

    # æ£€æµ‹æœåŠ¡
    service_name = manager.detect_service_from_context(str(e))

    # æç¤ºæ·»åŠ å‡­è¯
    if manager.prompt_add_credentials(service_name, str(e)):
        # é‡è¯•
        client = RAGFlowClient()
```

---

## ğŸ“‹ æ³¨å†Œæ–°æœåŠ¡

### åœ¨ä»£ç ä¸­æ³¨å†Œ

```python
from credentials_auto import get_auto_manager

manager = get_auto_manager()

# æ³¨å†Œæ–°æœåŠ¡
manager.register_service_pattern(
    service_name="MyService",
    url_patterns=["myservice", "æˆ‘çš„æœåŠ¡"],
    required_credentials=["username", "password", "api_key"],
    env_prefix="MYSERVICE_"
)
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ•°å­—äººåˆå§‹åŒ–

```python
# åœ¨æ•°å­—äººåˆå§‹åŒ–æ—¶ï¼Œè‡ªåŠ¨è·å–æ‰€æœ‰éœ€è¦çš„å‡­è¯
from credentials_auto import get_auto_manager

manager = get_auto_manager()

# è‡ªåŠ¨è·å–RAGFlowå‡­è¯
ragflow_creds = manager.auto_get_credentials("RAGFlow")
if ragflow_creds:
    # è®¾ç½®ç¯å¢ƒå˜é‡
    os.environ['RAGFLOW_USERNAME'] = ragflow_creds['username']
    os.environ['RAGFLOW_PASSWORD'] = ragflow_creds['password']
```

### åœºæ™¯2ï¼šé”™è¯¯å¤„ç†

```python
try:
    # å°è¯•æ“ä½œ
    result = some_service_call()
except Exception as e:
    # è‡ªåŠ¨æ£€æµ‹æ˜¯å¦éœ€è¦å‡­è¯
    manager = get_auto_manager()
    service_name = manager.auto_collect_from_error(str(e))

    if service_name:
        # è‡ªåŠ¨è·å–å‡­è¯å¹¶é‡è¯•
        credentials = manager.auto_get_credentials(service_name)
        if credentials:
            result = some_service_call()  # é‡è¯•
```

### åœºæ™¯3ï¼šæ—¥å¿—ç›‘æ§

```python
# ç›‘æ§æ—¥å¿—ï¼Œè‡ªåŠ¨æ”¶é›†å‡­è¯éœ€æ±‚
from credentials_collector import CredentialsCollector

collector = CredentialsCollector()

# è¯»å–æ—¥å¿—æ–‡ä»¶
with open('app.log', 'r') as f:
    for line in f:
        # æ£€æµ‹æ˜¯å¦éœ€è¦å‡­è¯
        result = collector.collect_from_error(line)
        if result and result['needs_credentials']:
            # è‡ªåŠ¨æ”¶é›†å¹¶ä¿å­˜
            collector.auto_collect_and_save(line, interactive=False)
```

---

## ğŸ”’ å®‰å…¨è¯´æ˜

1. **è‡ªåŠ¨æ”¶é›†æ—¶çš„å®‰å…¨**ï¼š
   - æå–çš„å¯†ç ä¸ä¼šåœ¨æ—¥å¿—ä¸­æ˜¾ç¤º
   - ä¿å­˜å‰ä¼šæç¤ºç”¨æˆ·ç¡®è®¤ï¼ˆäº¤äº’æ¨¡å¼ï¼‰

2. **è‡ªåŠ¨è°ƒç”¨æ—¶çš„å®‰å…¨**ï¼š
   - å‡­è¯åªåœ¨å†…å­˜ä¸­è§£å¯†
   - ä¸ä¼šå†™å…¥ä¸´æ—¶æ–‡ä»¶
   - ä½¿ç”¨åç«‹å³æ¸…é™¤ï¼ˆå¦‚æœå¯èƒ½ï¼‰

3. **æ—¥å¿—è®°å½•**ï¼š
   - æ‰€æœ‰è‡ªåŠ¨è°ƒç”¨éƒ½ä¼šè®°å½•æ—¥å¿—
   - å¯ä»¥æŸ¥çœ‹ä½¿ç”¨å†å²

---

## ğŸ“Š ä½¿ç”¨æ—¥å¿—

```python
from credentials_auto import get_auto_manager

manager = get_auto_manager()

# è·å–ä½¿ç”¨æ—¥å¿—
logs = manager.get_usage_log(service_name="RAGFlow")

for log in logs:
    print(f"{log['timestamp']}: {log['action']} - {log['success']}")
```

---

## ğŸ‰ æ€»ç»“

å¯†ç ç®¡ç†åº“ç°åœ¨å…·å¤‡ï¼š

1. âœ… **è‡ªåŠ¨æ£€æµ‹**ï¼šä»ä¸Šä¸‹æ–‡è‡ªåŠ¨æ£€æµ‹æœåŠ¡
2. âœ… **è‡ªåŠ¨æ”¶é›†**ï¼šä»é”™è¯¯ä¿¡æ¯ã€æ—¥å¿—ä¸­æå–å‡­è¯
3. âœ… **è‡ªåŠ¨è°ƒç”¨**ï¼šæ•°å­—äººéœ€è¦æ—¶è‡ªåŠ¨è·å–
4. âœ… **æ™ºèƒ½æç¤º**ï¼šç¼ºå¤±æ—¶æç¤ºç”¨æˆ·æ·»åŠ 
5. âœ… **ä½¿ç”¨æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰ä½¿ç”¨æƒ…å†µ

**æ•°å­—äººç°åœ¨å¯ä»¥æ›´æ™ºèƒ½åœ°ç®¡ç†å‡­è¯äº†ï¼**
