<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½¯ä»¶å·¥ç¨‹äº‹ä¸šéƒ¨ - AIæ•°å­—äººé˜Ÿä¼ç®¡ç†å¹³å°</title>
    <!-- CDNèµ„æºï¼Œæ·»åŠ é”™è¯¯å¤„ç† -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"
            onerror="console.warn('Chart.jsåŠ è½½å¤±è´¥ï¼Œå›¾è¡¨åŠŸèƒ½å°†ä¸å¯ç”¨')"></script>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"
            onerror="console.warn('Socket.IOåŠ è½½å¤±è´¥ï¼Œå®æ—¶æ›´æ–°åŠŸèƒ½å°†ä¸å¯ç”¨')"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"
            onerror="console.warn('MermaidåŠ è½½å¤±è´¥ï¼Œå¯è§†åŒ–åŠŸèƒ½å°†ä¸å¯ç”¨')"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .top-nav {
            background: #2c3e50;
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-title {
            font-size: 20px;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.3s;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255,255,255,0.2);
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* æ ‡ç­¾é¡µå¯¼èˆª */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        /* æ ‡ç­¾é¡µå†…å®¹ */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        /* ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .stat-card.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .stat-card.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card.info {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }

        /* æ•°å­—äººå¡ç‰‡ç½‘æ ¼ */
        .humans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .human-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .human-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .human-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .human-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }

        .human-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-idle { background: #e9ecef; color: #495057; }
        .status-working { background: #d1ecf1; color: #0c5460; }
        .status-error { background: #f8d7da; color: #721c24; }

        .human-info {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }

        .human-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        /* ä»»åŠ¡è¡¨æ ¼ */
        .task-table {
            width: 100%;
            border-collapse: collapse;
        }

        .task-table th {
            background: #f8f9fa;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
        }

        .task-table td {
            padding: 12px;
            border-top: 1px solid #eee;
        }

        .task-table tr:hover {
            background: #f8f9fa;
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-assigned { background: #cfe2ff; color: #084298; }
        .status-in_progress { background: #d1ecf1; color: #0c5460; }
        .status-completed { background: #d4edda; color: #155724; }
        .status-failed { background: #f8d7da; color: #721c24; }

        /* ä¼˜å…ˆçº§æ ‡ç­¾ */
        .priority-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .priority-low { background: #e9ecef; color: #495057; }
        .priority-medium { background: #fff3cd; color: #856404; }
        .priority-high { background: #ffeaa7; color: #856404; }
        .priority-urgent { background: #f8d7da; color: #721c24; }

        /* å¯è§†åŒ–å®¹å™¨ */
        .visualization-container {
            min-height: 500px;
            background: white;
            border-radius: 8px;
            padding: 20px;
        }

        .mermaid-container {
            min-height: 400px;
            overflow: auto;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .nav-links {
                flex-direction: column;
                gap: 10px;
            }

            .humans-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .empty {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #721c24;
            background: #f8d7da;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="top-nav">
        <div class="nav-content">
            <div class="nav-title">ğŸ¤– è½¯ä»¶å·¥ç¨‹äº‹ä¸šéƒ¨ - AIæ•°å­—äººé˜Ÿä¼ç®¡ç†å¹³å°</div>
            <div class="nav-links">
                <a href="/" class="nav-link active">é¦–é¡µ</a>
                <a href="/smart-planner" class="nav-link" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 8px 20px; border-radius: 20px; font-weight: bold;">ğŸŒŸ æ™ºèƒ½äº§å“è§„åˆ’å¸ˆ</a>
                <a href="/tasks" class="nav-link">ä»»åŠ¡ç®¡ç†</a>
                <a href="/visualization" class="nav-link">å¯è§†åŒ–</a>
                <a href="/docs/user-manual" class="nav-link">ğŸ“– æ“ä½œæ‰‹å†Œ</a>
                <a href="/docs/cursor-guide" class="nav-link">ğŸš€ ä½¿ç”¨æŒ‡å—</a>
                <a href="/docs/technical-spec" class="nav-link">ğŸ”§ æŠ€æœ¯è¯´æ˜</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('overview')">ğŸ“Š æ€»è§ˆ</button>
            <button class="tab" onclick="switchTab('humans')">ğŸ‘¥ æ•°å­—äººé˜Ÿä¼</button>
            <button class="tab" onclick="switchTab('tasks')">ğŸ“‹ ä»»åŠ¡ç®¡ç†</button>
            <button class="tab" onclick="switchTab('workflows')">ğŸ”„ å·¥ä½œæµ</button>
            <button class="tab" onclick="switchTab('visualization')">ğŸ“ˆ å¯è§†åŒ–</button>
            <button class="tab" onclick="switchTab('knowledge')">ğŸ“š çŸ¥è¯†åº“</button>
            <button class="tab" onclick="switchTab('sync')">ğŸ”„ æ•°æ®åŒæ­¥</button>
            <button class="tab" onclick="switchTab('docs')">ğŸ“– å¸®åŠ©æ–‡æ¡£</button>
        </div>

        <!-- æ€»è§ˆæ ‡ç­¾é¡µ -->
        <div id="overview-tab" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                    <div class="stat-value" id="totalTasks">-</div>
                </div>
                <div class="stat-card success">
                    <div class="stat-label">å·²å®Œæˆ</div>
                    <div class="stat-value" id="completedTasks">-</div>
                </div>
                <div class="stat-card warning">
                    <div class="stat-label">è¿›è¡Œä¸­</div>
                    <div class="stat-value" id="inProgressTasks">-</div>
                </div>
                <div class="stat-card info">
                    <div class="stat-label">æ•°å­—äººåœ¨çº¿</div>
                    <div class="stat-value" id="onlineHumans">-</div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</div>
                <div id="overview-content">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- æ•°å­—äººé˜Ÿä¼æ ‡ç­¾é¡µ -->
        <div id="humans-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ‘¥ æ•°å­—äººé˜Ÿä¼çŠ¶æ€</div>
                <div class="humans-grid" id="humans-grid">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- ä»»åŠ¡ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="tasks-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ“‹ æœ€è¿‘ä»»åŠ¡</div>
                <div id="tasks-content">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- å·¥ä½œæµæ ‡ç­¾é¡µ -->
        <div id="workflows-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ”„ å·¥ä½œæµç®¡ç†</div>
                <div id="workflows-content">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- å¯è§†åŒ–æ ‡ç­¾é¡µ -->
        <div id="visualization-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ“ˆ ä»»åŠ¡ä¾èµ–å¯è§†åŒ–</div>
                <div class="visualization-container">
                    <div id="mermaid-viz" class="mermaid-container">
                        <div class="loading">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- çŸ¥è¯†åº“æ ‡ç­¾é¡µ -->
        <div id="knowledge-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ“š çŸ¥è¯†åº“</div>
                <div id="knowledge-content">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- æ•°æ®åŒæ­¥æ ‡ç­¾é¡µ -->
        <div id="sync-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ”„ æ•°æ®åŒæ­¥</div>
                <div id="sync-content" style="padding: 20px;">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- å¸®åŠ©æ–‡æ¡£æ ‡ç­¾é¡µ -->
        <div id="docs-tab" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ“– å¸®åŠ©æ–‡æ¡£</div>
                <div style="padding: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                            <h3 style="margin-bottom: 10px; color: #2c3e50;">ğŸ“– ç”¨æˆ·æ“ä½œæ‰‹å†Œ</h3>
                            <p style="color: #666; margin-bottom: 15px;">å®Œæ•´çš„ç³»ç»Ÿæ“ä½œæŒ‡å—ï¼Œå›¾æ–‡å¹¶èŒ‚ï¼Œå‚»ç“œå¼è¯´æ˜ï¼ŒåŒ…å«æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
                            <a href="/docs/user-manual" target="_blank" style="display: inline-block; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 4px; margin-top: 10px;">æŸ¥çœ‹æ‰‹å†Œ â†’</a>
                        </div>
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #27ae60;">
                            <h3 style="margin-bottom: 10px; color: #2c3e50;">ğŸš€ Cursoré…åˆä½¿ç”¨æŒ‡å—</h3>
                            <p style="color: #666; margin-bottom: 15px;">å¦‚ä½•å°†AIæ•°å­—äººé˜Ÿä¼ä¸Cursoré…åˆä½¿ç”¨ï¼Œæé«˜ç¼–ç¨‹æ•ˆç‡çš„è¯¦ç»†æŒ‡å—å’Œå®æˆ˜æŠ€å·§ã€‚</p>
                            <a href="/docs/cursor-guide" target="_blank" style="display: inline-block; padding: 10px 20px; background: #27ae60; color: white; text-decoration: none; border-radius: 4px; margin-top: 10px;">æŸ¥çœ‹æŒ‡å— â†’</a>
                        </div>
                        <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #e74c3c;">
                            <h3 style="margin-bottom: 10px; color: #2c3e50;">ğŸ”§ ç³»ç»ŸæŠ€æœ¯è¯´æ˜</h3>
                            <p style="color: #666; margin-bottom: 15px;">æ•°å­—äººä»£ç ç”Ÿæˆèƒ½åŠ›ã€å¤§æ¨¡å‹é›†æˆã€ç¡¬ä»¶è¦æ±‚ç­‰è¯¦ç»†æŠ€æœ¯è¯´æ˜æ–‡æ¡£ã€‚</p>
                            <a href="/docs/technical-spec" target="_blank" style="display: inline-block; padding: 10px 20px; background: #e74c3c; color: white; text-decoration: none; border-radius: 4px; margin-top: 10px;">æŸ¥çœ‹è¯´æ˜ â†’</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;

        // å…ˆå£°æ˜ currentTab å˜é‡ï¼Œé¿å…åˆå§‹åŒ–é¡ºåºé—®é¢˜
        let currentTab = 'overview';

        // åˆå§‹åŒ–Mermaidï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if (typeof mermaid !== 'undefined') {
            try {
                mermaid.initialize({ startOnLoad: false, theme: 'default' });
            } catch (e) {
                console.warn('Mermaidåˆå§‹åŒ–å¤±è´¥:', e);
            }
        } else {
            console.warn('MermaidæœªåŠ è½½ï¼Œå¯è§†åŒ–åŠŸèƒ½å°†ä¸å¯ç”¨');
        }

        // WebSocketè¿æ¥
        let socket = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;

        function connectWebSocket() {
            if (typeof io === 'undefined') {
                console.warn('Socket.IOæœªåŠ è½½ï¼Œå®æ—¶æ›´æ–°åŠŸèƒ½å°†ä¸å¯ç”¨');
                return;
            }

            try {
                socket = io({
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionDelayMax: 5000,
                    reconnectionAttempts: maxReconnectAttempts,
                    timeout: 20000,
                    transports: ['websocket', 'polling']
                });

                socket.on('connect', function() {
                    console.log('âœ… WebSocketå·²è¿æ¥');
                    reconnectAttempts = 0;
                    socket.emit('subscribe', {type: 'all'});
                    updateWebSocketStatus(true);
                });

                socket.on('disconnect', function(reason) {
                    console.warn('âš ï¸ WebSocketå·²æ–­å¼€:', reason);
                    updateWebSocketStatus(false);
                });

                socket.on('connect_error', function(error) {
                    console.error('âŒ WebSocketè¿æ¥é”™è¯¯:', error);
                    reconnectAttempts++;
                    if (reconnectAttempts >= maxReconnectAttempts) {
                        console.error('âŒ WebSocketé‡è¿å¤±è´¥ï¼Œå·²è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°');
                        updateWebSocketStatus(false);
                    } else {
                        console.log(`ğŸ”„ æ­£åœ¨é‡è¿... (${reconnectAttempts}/${maxReconnectAttempts})`);
                    }
                });

                socket.on('reconnect', function(attemptNumber) {
                    console.log(`âœ… WebSocketé‡è¿æˆåŠŸ (å°è¯• ${attemptNumber})`);
                    reconnectAttempts = 0;
                    updateWebSocketStatus(true);
                });

                socket.on('reconnect_attempt', function(attemptNumber) {
                    console.log(`ğŸ”„ WebSocketé‡è¿å°è¯• ${attemptNumber}/${maxReconnectAttempts}`);
                });

                socket.on('reconnect_failed', function() {
                    console.error('âŒ WebSocketé‡è¿å¤±è´¥');
                    updateWebSocketStatus(false);
                });

                socket.on('task_update', function(data) {
                    console.log('ä»»åŠ¡æ›´æ–°:', data);
                    if (currentTab === 'tasks' || currentTab === 'overview') {
                        loadTasks();
                    }
                });

                socket.on('statistics_update', function(data) {
                    console.log('ç»Ÿè®¡æ›´æ–°:', data);
                    updateStatistics(data);
                });

                socket.on('digital_human_update', function(data) {
                    console.log('æ•°å­—äººæ›´æ–°:', data);
                    if (currentTab === 'humans' || currentTab === 'overview') {
                        loadDigitalHumans();
                    }
                });
            } catch (e) {
                console.error('WebSocketè¿æ¥å¤±è´¥:', e);
                updateWebSocketStatus(false);
            }
        }

        function updateWebSocketStatus(connected) {
            // æ›´æ–°çŸ¥è¯†åº“é¡µé¢çš„çŠ¶æ€æ˜¾ç¤º
            const knowledgeContent = document.getElementById('knowledge-content');
            if (knowledgeContent) {
                const currentHTML = knowledgeContent.innerHTML;
                const newHTML = currentHTML.replace(
                    /å½“å‰çŠ¶æ€:.*?WebSocket.*?/,
                    `å½“å‰çŠ¶æ€: ${connected ? 'âœ… WebSocketå·²è¿æ¥' : 'âš ï¸ WebSocketæœªè¿æ¥'}`
                );
                if (newHTML !== currentHTML) {
                    knowledgeContent.innerHTML = newHTML;
                }
            }
        }

        // åˆå§‹åŒ–WebSocketè¿æ¥
        connectWebSocket();

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            currentTab = tabName;

            // åŠ è½½å¯¹åº”æ ‡ç­¾é¡µçš„æ•°æ®
            switch(tabName) {
                case 'overview':
                    loadOverview();
                    break;
                case 'humans':
                    loadDigitalHumans();
                    break;
                case 'tasks':
                    loadTasks();
                    break;
                case 'workflows':
                    loadWorkflows();
                    break;
                case 'visualization':
                    loadVisualization();
                    break;
                case 'knowledge':
                    loadKnowledge();
                    break;
                case 'sync':
                    loadSync();
                    break;
                case 'docs':
                    // å¸®åŠ©æ–‡æ¡£é¡µé¢ä¸éœ€è¦åŠ è½½æ•°æ®
                    break;
            }
        }

        async function loadOverview() {
            const content = document.getElementById('overview-content');
            if (!content) {
                console.error('æ‰¾ä¸åˆ°overview-contentå…ƒç´ ');
                return;
            }

            try {
                content.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

                // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
                console.log('å¼€å§‹åŠ è½½ç»Ÿè®¡ä¿¡æ¯...');
                const statsRes = await fetch(`${API_BASE}/api/tasks/statistics`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!statsRes.ok) {
                    throw new Error(`ç»Ÿè®¡APIé”™è¯¯: ${statsRes.status} ${statsRes.statusText}`);
                }

                const stats = await statsRes.json();
                console.log('ç»Ÿè®¡ä¿¡æ¯åŠ è½½æˆåŠŸ:', stats);
                updateStatistics(stats);

                // åŠ è½½æ•°å­—äººçŠ¶æ€
                console.log('å¼€å§‹åŠ è½½æ•°å­—äººçŠ¶æ€...');
                const humansRes = await fetch(`${API_BASE}/api/digital-humans`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!humansRes.ok) {
                    throw new Error(`æ•°å­—äººAPIé”™è¯¯: ${humansRes.status} ${humansRes.statusText}`);
                }

                const humans = await humansRes.json();
                console.log('æ•°å­—äººçŠ¶æ€åŠ è½½æˆåŠŸ:', humans);
                const onlineCount = Object.values(humans || {}).filter(h => h && h.status !== 'error').length;
                const onlineHumansEl = document.getElementById('onlineHumans');
                if (onlineHumansEl) {
                    onlineHumansEl.textContent = onlineCount;
                }

                // æ˜¾ç¤ºæ¦‚è§ˆå†…å®¹
                if (content) {
                    content.innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div>
                                <h3 style="margin-bottom: 10px;">ç³»ç»ŸçŠ¶æ€</h3>
                                <p>âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸</p>
                                <p>âœ… ${onlineCount} ä¸ªæ•°å­—äººåœ¨çº¿</p>
                                <p>${socket && socket.connected ? 'âœ… WebSocketè¿æ¥æ­£å¸¸' : 'âš ï¸ WebSocketæœªè¿æ¥'}</p>
                            </div>
                            <div>
                                <h3 style="margin-bottom: 10px;">å¿«é€Ÿæ“ä½œ</h3>
                                <a href="/smart-planner" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; margin-bottom: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">ğŸŒŸ ä¸æ™ºèƒ½äº§å“è§„åˆ’å¸ˆå¯¹è¯</a>
                                <div style="margin-top: 10px;">
                                    <button class="btn btn-primary" onclick="switchTab('tasks')">æŸ¥çœ‹ä»»åŠ¡</button>
                                    <button class="btn btn-primary" onclick="switchTab('humans')">æŸ¥çœ‹æ•°å­—äºº</button>
                                    <button class="btn btn-primary" onclick="switchTab('workflows')">æŸ¥çœ‹å·¥ä½œæµ</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('åŠ è½½æ¦‚è§ˆå¤±è´¥:', error);
                if (content) {
                    content.innerHTML = `<div class="error">åŠ è½½å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}<br><small>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–è¯¦ç»†ä¿¡æ¯</small><br><button class="btn btn-primary" onclick="loadOverview()" style="margin-top: 10px;">é‡è¯•</button></div>`;
                }
            }
        }

        async function loadDigitalHumans() {
            const grid = document.getElementById('humans-grid');
            if (!grid) {
                console.error('æ‰¾ä¸åˆ°humans-gridå…ƒç´ ');
                return;
            }

            try {
                grid.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

                const response = await fetch(`${API_BASE}/api/digital-humans`);

                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);
                }

                const humans = await response.json();

                if (!humans || typeof humans !== 'object') {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼é”™è¯¯');
                }

                grid.innerHTML = '';

                const entries = Object.entries(humans);
                if (entries.length === 0) {
                    grid.innerHTML = '<div class="empty">æš‚æ— æ•°å­—äºº</div>';
                    return;
                }

                for (const [role, data] of entries) {
                    const card = document.createElement('div');
                    card.className = 'human-card';

                    // è½¬ä¹‰HTMLé˜²æ­¢XSS
                    const safeRole = role.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    const safeDept = (data.department || 'æœªçŸ¥').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    const safeStatus = (data.status || 'idle').replace(/</g, '&lt;').replace(/>/g, '&gt;');
                    const workCount = data.work_count || 0;

                    card.innerHTML = `
                        <div class="human-header">
                            <div class="human-name">${safeRole}</div>
                            <div class="human-status status-${safeStatus}">${getStatusText(safeStatus)}</div>
                        </div>
                        <div class="human-info">éƒ¨é—¨: ${safeDept}</div>
                        <div class="human-info">å·²å®Œæˆä»»åŠ¡: ${workCount}</div>
                        ${data.current_task ? `<div class="human-info">å½“å‰ä»»åŠ¡: ${(data.current_task.type || 'æ— ').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>` : ''}
                        <div class="human-actions">
                            <button class="btn btn-primary" onclick="viewHumanTasks('${safeRole.replace(/'/g, "\\'")}')">æŸ¥çœ‹ä»»åŠ¡</button>
                        </div>
                    `;
                    grid.appendChild(card);
                }
            } catch (error) {
                console.error('åŠ è½½æ•°å­—äººå¤±è´¥:', error);
                grid.innerHTML = `<div class="error">åŠ è½½å¤±è´¥: ${error.message || 'æœªçŸ¥é”™è¯¯'}<br><button class="btn btn-primary" onclick="loadDigitalHumans()" style="margin-top: 10px;">é‡è¯•</button></div>`;
            }
        }

        async function loadTasks() {
            try {
                const response = await fetch(`${API_BASE}/api/tasks/history/recent?hours=24&limit=20`);
                const data = await response.json();

                const content = document.getElementById('tasks-content');

                let html = '<div style="margin-bottom: 20px;"><button class="btn btn-primary" onclick="showCreateTaskModal()">â• åˆ›å»ºæ–°ä»»åŠ¡</button></div>';

                if (data.success && data.tasks.length > 0) {
                    html += '<table class="task-table"><thead><tr><th>ä»»åŠ¡ID</th><th>ç±»å‹</th><th>è§’è‰²</th><th>çŠ¶æ€</th><th>ä¼˜å…ˆçº§</th><th>åˆ›å»ºæ—¶é—´</th></tr></thead><tbody>';

                    data.tasks.forEach(task => {
                        html += `
                            <tr>
                                <td><code>${task.task_id.substring(0, 8)}...</code></td>
                                <td>${task.task_type}</td>
                                <td>${task.role_name || '-'}</td>
                                <td><span class="status-badge status-${task.status}">${getStatusText(task.status)}</span></td>
                                <td><span class="priority-badge priority-${getPriorityClass(task.priority)}">${getPriorityText(task.priority)}</span></td>
                                <td>${formatDate(task.created_at)}</td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                } else {
                    html += '<div class="empty">æš‚æ— ä»»åŠ¡</div>';
                }

                content.innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½ä»»åŠ¡å¤±è´¥:', error);
                document.getElementById('tasks-content').innerHTML = '<div class="error">åŠ è½½å¤±è´¥</div>';
            }
        }

        function showCreateTaskModal() {
            const modal = document.createElement('div');
            modal.id = 'create-task-modal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;

            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
                    <h2 style="margin-bottom: 20px;">åˆ›å»ºæ–°ä»»åŠ¡</h2>
                    <form id="create-task-form">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ä»»åŠ¡ç±»å‹ *</label>
                            <select id="task-type" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="">è¯·é€‰æ‹©ä»»åŠ¡ç±»å‹</option>
                                <option value="create_plan">åˆ›å»ºè®¡åˆ’</option>
                                <option value="design_architecture">è®¾è®¡æ¶æ„</option>
                                <option value="develop_frontend">å‰ç«¯å¼€å‘</option>
                                <option value="develop_backend">åç«¯å¼€å‘</option>
                                <option value="deploy">éƒ¨ç½²</option>
                                <option value="test">æµ‹è¯•</option>
                                <option value="code_review">ä»£ç å®¡æŸ¥</option>
                                <option value="documentation">ç¼–å†™æ–‡æ¡£</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ä¼˜å…ˆçº§ *</label>
                            <select id="task-priority" required style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="low">ä½</option>
                                <option value="medium" selected>ä¸­</option>
                                <option value="high">é«˜</option>
                                <option value="urgent">ç´§æ€¥</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ä»»åŠ¡æè¿° *</label>
                            <textarea id="task-description" required placeholder="è¯·è¾“å…¥ä»»åŠ¡æè¿°..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 100px; font-family: inherit;"></textarea>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">é¢å¤–ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼Œå¯é€‰ï¼‰</label>
                            <textarea id="task-metadata" placeholder='{"key": "value"}' style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; min-height: 60px; font-family: monospace; font-size: 12px;"></textarea>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                            <button type="button" onclick="closeCreateTaskModal()" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 4px; cursor: pointer;">å–æ¶ˆ</button>
                            <button type="submit" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">åˆ›å»ºä»»åŠ¡</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);

            document.getElementById('create-task-form').addEventListener('submit', async function(e) {
                e.preventDefault();

                const taskType = document.getElementById('task-type').value;
                const priority = document.getElementById('task-priority').value;
                const description = document.getElementById('task-description').value;
                const metadataText = document.getElementById('task-metadata').value;

                let metadata = {};
                if (metadataText.trim()) {
                    try {
                        metadata = JSON.parse(metadataText);
                    } catch (e) {
                        alert('é¢å¤–ä¿¡æ¯æ ¼å¼é”™è¯¯ï¼Œè¯·ä½¿ç”¨æœ‰æ•ˆçš„JSONæ ¼å¼');
                        return;
                    }
                }

                const taskData = {
                    task_type: taskType,
                    priority: priority,
                    input_data: {
                        description: description
                    },
                    metadata: metadata
                };

                try {
                    const response = await fetch(`${API_BASE}/api/tasks`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(taskData)
                    });

                    if (response.ok) {
                        const task = await response.json();
                        alert(`âœ… ä»»åŠ¡åˆ›å»ºæˆåŠŸï¼\nä»»åŠ¡ID: ${task.id.substring(0, 8)}...\nçŠ¶æ€: ${getStatusText(task.status)}\nåˆ†é…è§’è‰²: ${task.assigned_to || 'å¾…åˆ†é…'}`);
                        closeCreateTaskModal();
                        loadTasks();
                        if (currentTab === 'overview') {
                            loadOverview();
                        }
                    } else {
                        const error = await response.json();
                        alert('âŒ åˆ›å»ºå¤±è´¥: ' + (error.error || 'æœªçŸ¥é”™è¯¯'));
                    }
                } catch (error) {
                    alert('âŒ åˆ›å»ºå¤±è´¥: ' + error.message);
                }
            });
        }

        function closeCreateTaskModal() {
            const modal = document.getElementById('create-task-modal');
            if (modal) {
                modal.remove();
            }
        }

        async function loadWorkflows() {
            try {
                const response = await fetch(`${API_BASE}/api/workflows`);
                const workflows = await response.json();

                const content = document.getElementById('workflows-content');

                if (workflows.length > 0) {
                    let html = '<table class="task-table"><thead><tr><th>å·¥ä½œæµåç§°</th><th>çŠ¶æ€</th><th>æ­¥éª¤æ•°</th><th>åˆ›å»ºæ—¶é—´</th><th>æ“ä½œ</th></tr></thead><tbody>';

                    workflows.forEach(wf => {
                        html += `
                            <tr>
                                <td><strong>${wf.name}</strong></td>
                                <td><span class="status-badge status-${wf.status}">${wf.status}</span></td>
                                <td>${wf.steps ? wf.steps.length : 0}</td>
                                <td>${formatDate(wf.created_at)}</td>
                                <td>
                                    <button class="btn btn-primary" onclick="viewWorkflow('${wf.id}')">æŸ¥çœ‹</button>
                                </td>
                            </tr>
                        `;
                    });

                    html += '</tbody></table>';
                    content.innerHTML = html;
                } else {
                    content.innerHTML = '<div class="empty">æš‚æ— å·¥ä½œæµ</div>';
                }
            } catch (error) {
                console.error('åŠ è½½å·¥ä½œæµå¤±è´¥:', error);
                document.getElementById('workflows-content').innerHTML = '<div class="error">åŠ è½½å¤±è´¥</div>';
            }
        }

        async function loadVisualization() {
            try {
                const response = await fetch(`${API_BASE}/api/visualization/tasks/mermaid`);
                const data = await response.json();

                if (data.success) {
                    const container = document.getElementById('mermaid-viz');
                    if (typeof mermaid !== 'undefined') {
                        container.innerHTML = '<div class="mermaid">' + data.mermaid + '</div>';
                        mermaid.run();
                    } else {
                        container.innerHTML = '<div class="error">MermaidæœªåŠ è½½ï¼Œæ— æ³•æ˜¾ç¤ºå¯è§†åŒ–å›¾è¡¨ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢ã€‚</div>';
                    }
                }
            } catch (error) {
                console.error('åŠ è½½å¯è§†åŒ–å¤±è´¥:', error);
                const container = document.getElementById('mermaid-viz');
                if (container) {
                    container.innerHTML = '<div class="error">åŠ è½½å¯è§†åŒ–å¤±è´¥: ' + error.message + '</div>';
                }
            }
        }

        async function loadKnowledge() {
            const content = document.getElementById('knowledge-content');
            content.innerHTML = `
                <div>
                    <h3>çŸ¥è¯†åº“åŠŸèƒ½</h3>
                    <p>çŸ¥è¯†åº“é›†æˆRAGFlowï¼Œæ”¯æŒçŸ¥è¯†æ£€ç´¢å’Œè‡ªåŠ¨æ²‰æ·€ã€‚</p>
                    <p>å½“å‰çŠ¶æ€: ${socket && socket.connected ? 'âœ… WebSocketå·²è¿æ¥' : 'âš ï¸ WebSocketæœªè¿æ¥'}</p>
                    <button class="btn btn-primary" onclick="searchKnowledge()">æœç´¢çŸ¥è¯†</button>
                </div>
            `;
        }

        async function loadSync() {
            const content = document.getElementById('sync-content');
            try {
                content.innerHTML = '<div class="loading">åŠ è½½åŒæ­¥çŠ¶æ€...</div>';

                const response = await fetch(`${API_BASE}/api/sync/status`);
                if (!response.ok) {
                    throw new Error(`HTTPé”™è¯¯: ${response.status}`);
                }
                const status = await response.json();

                let html = '<div style="display: grid; gap: 20px;">';

                // GitçŠ¶æ€
                html += `
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #3498db;">
                        <h3 style="margin-bottom: 15px;">ğŸ“¦ Gitä»£ç åŒæ­¥</h3>
                        <p><strong>çŠ¶æ€:</strong> ${status.git.available ? 'âœ… ' + status.git.message : 'âŒ ' + status.git.message}</p>
                        ${status.git.has_changes ? '<p style="color: #e74c3c;">âš ï¸ æœ‰æœªæäº¤çš„æ›´æ”¹</p>' : ''}
                        ${!status.git.has_remote ? '<p style="color: #f39c12;">âš ï¸ æœªé…ç½®è¿œç¨‹ä»“åº“</p>' : ''}
                        <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="syncGitPush()">ğŸ“¤ æ¨é€åˆ°GitHub</button>
                            <button class="btn btn-primary" onclick="syncGitPull()">ğŸ“¥ ä»GitHubæ‹‰å–</button>
                            ${!status.git.has_remote ? '<button class="btn btn-secondary" onclick="showGitSetup()">âš™ï¸ é…ç½®è¿œç¨‹ä»“åº“</button>' : ''}
                        </div>
                    </div>
                `;

                // æ•°æ®åº“çŠ¶æ€
                html += `
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #27ae60;">
                        <h3 style="margin-bottom: 15px;">ğŸ’¾ æ•°æ®åº“åŒæ­¥</h3>
                        <p><strong>æ•°æ®åº“å¤§å°:</strong> ${status.database.size_mb} MB</p>
                        <p><strong>çŠ¶æ€:</strong> ${status.database.exists ? 'âœ… æ•°æ®åº“å­˜åœ¨' : 'âŒ æ•°æ®åº“ä¸å­˜åœ¨'}</p>
                        <div style="margin-top: 15px;">
                            <h4>å¯ç”¨å­˜å‚¨é€‰é¡¹:</h4>
                            <div style="display: grid; gap: 10px; margin-top: 10px;">
                `;

                if (status.storage_options && status.storage_options.length > 0) {
                    status.storage_options.forEach(option => {
                        const safePath = option.path.replace(/'/g, "\\'");
                        html += `
                            <div style="padding: 15px; background: white; border-radius: 4px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <strong>${option.type}</strong>
                                    <p style="margin: 5px 0; color: #666; font-size: 14px;">${option.description}</p>
                                    <p style="margin: 0; color: #999; font-size: 12px; word-break: break-all;">${option.path}</p>
                                </div>
                                <button class="btn btn-primary" onclick="syncDatabase('${option.type}', '${safePath}')" style="margin-left: 10px;">åŒæ­¥</button>
                            </div>
                        `;
                    });
                } else {
                    html += '<p style="color: #999;">æœªæ£€æµ‹åˆ°å¯ç”¨çš„å­˜å‚¨é€‰é¡¹</p>';
                }

                html += `
                            </div>
                        </div>
                    </div>
                `;

                html += '</div>';
                content.innerHTML = html;
            } catch (error) {
                console.error('åŠ è½½åŒæ­¥çŠ¶æ€å¤±è´¥:', error);
                content.innerHTML = `<div class="error">åŠ è½½å¤±è´¥: ${error.message}<br><small>è¯·ç¡®ä¿åŒæ­¥ç®¡ç†æ¨¡å—å·²æ­£ç¡®å®‰è£…</small></div>`;
            }
        }

        async function syncGitPush() {
            const message = prompt('è¯·è¾“å…¥æäº¤ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰:', `Auto sync: ${new Date().toLocaleString('zh-CN')}`);
            try {
                const response = await fetch(`${API_BASE}/api/sync/git/push`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({message: message || undefined})
                });
                const result = await response.json();
                if (result.success) {
                    alert('âœ… ' + result.message);
                    loadSync();
                } else {
                    alert('âŒ ' + result.error);
                }
            } catch (error) {
                alert('âŒ åŒæ­¥å¤±è´¥: ' + error.message);
            }
        }

        async function syncGitPull() {
            if (!confirm('ç¡®å®šè¦ä»GitHubæ‹‰å–æœ€æ–°ä»£ç å—ï¼Ÿè¿™å¯èƒ½ä¼šè¦†ç›–æœ¬åœ°æ›´æ”¹ã€‚')) return;
            try {
                const response = await fetch(`${API_BASE}/api/sync/git/pull`, {
                    method: 'POST'
                });
                const result = await response.json();
                if (result.success) {
                    alert('âœ… ' + result.message);
                    loadSync();
                } else {
                    alert('âŒ ' + result.error);
                }
            } catch (error) {
                alert('âŒ æ‹‰å–å¤±è´¥: ' + error.message);
            }
        }

        function showGitSetup() {
            const url = prompt('è¯·è¾“å…¥GitHubä»“åº“URL:', 'https://github.com/your-username/repo-name.git');
            if (!url) return;

            fetch(`${API_BASE}/api/sync/git/setup`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({remote_url: url})
            })
            .then(res => res.json())
            .then(result => {
                if (result.success) {
                    alert('âœ… ' + result.message);
                    loadSync();
                } else {
                    alert('âŒ ' + result.error);
                }
            })
            .catch(error => alert('âŒ è®¾ç½®å¤±è´¥: ' + error.message));
        }

        async function syncDatabase(storageType, storagePath) {
            if (!confirm(`ç¡®å®šè¦åŒæ­¥æ•°æ®åº“åˆ° ${storageType} å—ï¼Ÿ`)) return;
            try {
                const response = await fetch(`${API_BASE}/api/sync/database`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        storage_type: storageType,
                        storage_path: storagePath
                    })
                });
                const result = await response.json();
                if (result.success) {
                    alert(`âœ… ${result.message}\næ“ä½œ: ${result.action}`);
                    loadSync();
                } else {
                    alert('âŒ ' + result.error);
                }
            } catch (error) {
                alert('âŒ åŒæ­¥å¤±è´¥: ' + error.message);
            }
        }

        function updateStatistics(stats) {
            if (stats) {
                document.getElementById('totalTasks').textContent = stats.total || 0;
                document.getElementById('completedTasks').textContent = stats.by_status?.completed || 0;
                document.getElementById('inProgressTasks').textContent = stats.by_status?.in_progress || 0;
            }
        }

        function getStatusText(status) {
            const map = {
                'pending': 'å¾…åˆ†é…',
                'assigned': 'å·²åˆ†é…',
                'in_progress': 'è¿›è¡Œä¸­',
                'completed': 'å·²å®Œæˆ',
                'failed': 'å¤±è´¥',
                'idle': 'ç©ºé—²',
                'working': 'å·¥ä½œä¸­',
                'error': 'é”™è¯¯'
            };
            return map[status] || status;
        }

        function getPriorityClass(priority) {
            if (priority <= 1) return 'low';
            if (priority <= 2) return 'medium';
            if (priority <= 3) return 'high';
            return 'urgent';
        }

        function getPriorityText(priority) {
            const map = {1: 'ä½', 2: 'ä¸­', 3: 'é«˜', 4: 'ç´§æ€¥'};
            return map[priority] || priority;
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN');
        }

        function viewHumanTasks(role) {
            switchTab('tasks');
            // å¯ä»¥æ·»åŠ è¿‡æ»¤é€»è¾‘
        }

        function viewWorkflow(id) {
            window.location.href = `/workflows/${id}`;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            loadOverview();

            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°å½“å‰æ ‡ç­¾é¡µ
            setInterval(() => {
                switch(currentTab) {
                    case 'overview':
                        loadOverview();
                        break;
                    case 'humans':
                        loadDigitalHumans();
                        break;
                    case 'tasks':
                        loadTasks();
                        break;
                    case 'workflows':
                        loadWorkflows();
                        break;
                case 'visualization':
                    loadVisualization();
                    break;
                case 'sync':
                    loadSync();
                    break;
                case 'docs':
                    // å¸®åŠ©æ–‡æ¡£é¡µé¢ä¸éœ€è¦åŠ è½½æ•°æ®
                    break;
            }
        }, 30000);
        };
    </script>
</body>
</html>
