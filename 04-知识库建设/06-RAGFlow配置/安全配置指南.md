# RAGFlow 安全配置指南

## 🔐 安全原则

**重要**：**永远不要在代码中硬编码密码！**

所有敏感信息（账号、密码、API密钥）都应该存储在环境变量中。

---

## 📋 配置方式

### 方式1：使用环境变量文件（推荐）

在 `~/DeveloperConfig/环境变量/.env.work` 中添加：

```bash
# RAGFlow配置
RAGFLOW_BASE_URL=https://ragflow.suuntoyun.com
RAGFLOW_USERNAME=your-username
RAGFLOW_PASSWORD=your-password
RAGFLOW_API_KEY=  # 如果需要API密钥（通常不需要）

# 知识库ID（创建后填写）
RAGFLOW_KB_ORGANIZATION=your-organization-kb-id
RAGFLOW_KB_PROJECT_EXPERIENCE=your-project-experience-kb-id
# ... 其他知识库ID
```

### 方式2：使用系统环境变量

```bash
# 在 ~/.zshrc 或 ~/.bash_profile 中添加
export RAGFLOW_BASE_URL=https://ragflow.suuntoyun.com
export RAGFLOW_USERNAME=your-username
export RAGFLOW_PASSWORD=your-password
```

---

## 🔒 安全建议

### 1. 环境变量文件权限

确保环境变量文件只有你可以访问：

```bash
# 设置文件权限（只有所有者可以读写）
chmod 600 ~/DeveloperConfig/环境变量/.env.work
```

### 2. 不要提交到Git

确保 `.env.work` 文件在 `.gitignore` 中：

```bash
# 在项目根目录的 .gitignore 中添加
.env.work
*.env
```

### 3. 使用密码管理器

建议使用密码管理器（如1Password、LastPass）来管理密码，而不是直接写在文件中。

---

## 🧪 测试配置

### 测试环境变量是否加载

```bash
# 检查环境变量
echo $RAGFLOW_BASE_URL
echo $RAGFLOW_USERNAME
# 注意：不要直接打印密码！
```

### 测试RAGFlow连接

```bash
cd "04-知识库建设/06-RAGFlow配置"
python3 test_ragflow_connection.py
```

---

## 📝 配置步骤

### 第一步：创建/编辑环境变量文件

```bash
# 编辑环境变量文件
nano ~/DeveloperConfig/环境变量/.env.work
# 或使用其他编辑器
code ~/DeveloperConfig/环境变量/.env.work
```

### 第二步：添加RAGFlow配置

```bash
# RAGFlow配置
RAGFLOW_BASE_URL=https://ragflow.suuntoyun.com
RAGFLOW_USERNAME=你的用户名
RAGFLOW_PASSWORD=你的密码
```

### 第三步：设置文件权限

```bash
chmod 600 ~/DeveloperConfig/环境变量/.env.work
```

### 第四步：测试连接

```bash
cd "04-知识库建设/06-RAGFlow配置"
python3 test_ragflow_connection.py
```

---

## ⚠️ 注意事项

### 1. 密码安全
- ✅ **使用环境变量**：密码存储在环境变量文件中
- ❌ **不要硬编码**：不要在代码中直接写密码
- ❌ **不要提交到Git**：确保密码文件在.gitignore中

### 2. 环境变量加载
- 确保运行脚本时环境变量已加载
- 如果使用 `.env.work`，确保脚本能读取该文件

### 3. API认证方式
- RAGFlow可能使用Session Token或Cookie认证
- 如果登录失败，可能需要检查RAGFlow的API文档

---

## 🔧 故障排除

### 问题1：环境变量未加载

**解决方案**：
```bash
# 手动加载环境变量
source ~/DeveloperConfig/环境变量/.env.work

# 或者在脚本中使用python-dotenv
pip install python-dotenv
```

### 问题2：登录失败

**可能原因**：
1. 用户名或密码错误
2. RAGFlow的登录API端点不同
3. 需要额外的认证参数

**解决方案**：
1. 检查用户名和密码是否正确
2. 查看RAGFlow的API文档，确认登录端点
3. 如果使用Cookie认证，可能需要手动获取Cookie

### 问题3：权限不足

**解决方案**：
```bash
# 检查文件权限
ls -l ~/DeveloperConfig/环境变量/.env.work

# 设置正确的权限
chmod 600 ~/DeveloperConfig/环境变量/.env.work
```

---

## 📚 相关文档

- **环境变量管理指南**：`03-技术实现/05-配置管理/环境变量管理指南.md`
- **RAGFlow服务器信息**：`RAGFlow服务器信息.md`
- **知识库建设操作指南**：`知识库建设操作指南.md`

---

**记住：安全第一！永远不要在代码中硬编码密码！**
